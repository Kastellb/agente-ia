<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Leveler</title>
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #64748b;
            --background: #f8fafc;
            --card: #ffffff;
            --text: #1e293b;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--background);
            color: var(--text);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: var(--card);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        header {
            background: var(--primary);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .voice-search-btn {
            position: absolute;
            right: 20px;
            top: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .search-section {
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
        }

        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        #lessonInput {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            font-size: 16px;
        }

        #searchBtn {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0 20px;
            font-weight: 600;
            cursor: pointer;
        }

        .audio-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }

        .audio-btn {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s, background-color 0.2s;
        }

        .audio-btn:hover {
            transform: scale(1.05);
        }

        .audio-btn:active {
            transform: scale(0.95);
        }

        .audio-btn.stop {
            background: var(--error);
        }

        .audio-btn:disabled {
            background: var(--secondary);
            cursor: not-allowed;
            transform: none;
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-left: 15px;
        }

        .lesson-content {
            padding: 0 20px 20px;
            display: none;
        }

        .lesson-header {
            margin: 20px 0 15px;
            color: var(--primary);
        }

        .theory-content {
            background: #f1f5f9;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            line-height: 1.8;
            white-space: pre-line;
        }

        .practice-section {
            margin-top: 25px;
        }

        .practice-btn {
            background: var(--success);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: block;
            width: 100%;
            transition: background-color 0.2s;
        }

        .practice-btn:hover {
            background: #0da271;
        }

        .practice-btn:disabled {
            background: var(--secondary);
            cursor: not-allowed;
        }

        .status-indicator {
            text-align: center;
            padding: 10px;
            font-style: italic;
            color: var(--secondary);
        }

        .voice-commands {
            margin-top: 15px;
            padding: 10px;
            background: #f0f9ff;
            border-radius: 8px;
            font-size: 14px;
            text-align: center;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        footer {
            text-align: center;
            padding: 20px;
            color: var(--secondary);
            font-size: 14px;
            border-top: 1px solid #e2e8f0;
        }

        .pulse {
            animation: pulse-animation 1.5s infinite;
        }

        @keyframes pulse-animation {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @media (max-width: 600px) {
            .search-box {
                flex-direction: column;
            }
            
            #searchBtn {
                padding: 12px;
            }
            
            .audio-controls {
                flex-wrap: wrap;
            }
            
            .voice-search-btn {
                position: relative;
                right: auto;
                top: auto;
                margin-top: 10px;
                align-self: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>English Leveler</h1>
            <p>Learn and practice English</p>
            <button class="voice-search-btn" id="voiceSearchBtn" title="Voice Search">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                    <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                    <line x1="12" y1="19" x2="12" y2="23"></line>
                    <line x1="8" y1="23" x2="16" y2="23"></line>
                </svg>
            </button>
        </header>

        <div class="search-section">
            <div class="search-box">
                <input type="text" id="lessonInput" placeholder="Enter lesson number or name (e.g. 'Lesson 45' or 'Past Perfect')">
                <button id="searchBtn">Load Lesson</button>
            </div>
            
            <div class="audio-controls">
                <button class="audio-btn" id="playBtn" disabled>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="5 3 19 12 5 21 5 3"></polygon>
                    </svg>
                </button>
                <button class="audio-btn stop" id="stopBtn" disabled>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="6" y="4" width="4" height="16"></rect>
                        <rect x="14" y="4" width="4" height="16"></rect>
                    </svg>
                </button>
                
                <div class="speed-control">
                    <label for="speedSelect">Speed:</label>
                    <select id="speedSelect">
                        <option value="0.8">Slow</option>
                        <option value="1" selected>Normal</option>
                        <option value="1.2">Fast</option>
                    </select>
                </div>
            </div>
            
            <div class="voice-commands">
                <p>Try saying: <strong>"Lesson 45"</strong>, <strong>"Future Continuous"</strong>, or <strong>"Practice"</strong></p>
            </div>
            
            <div class="status-indicator" id="statusText">Select a lesson to begin</div>
        </div>

        <div class="lesson-content" id="lessonContent">
            <h2 class="lesson-header" id="lessonTitle"></h2>
            <div class="theory-content" id="theoryContent"></div>
            
            <div class="practice-section">
                <button class="practice-btn" id="practiceBtn" disabled>Start Practice</button>
            </div>
        </div>

        <footer>
            <p>St. Mary's College English Leveler • © 2023</p>
        </footer>
    </div>

    <script>
        // Elementos DOM
        const lessonInput = document.getElementById('lessonInput');
        const searchBtn = document.getElementById('searchBtn');
        const lessonContent = document.getElementById('lessonContent');
        const lessonTitle = document.getElementById('lessonTitle');
        const theoryContent = document.getElementById('theoryContent');
        const practiceBtn = document.getElementById('practiceBtn');
        const playBtn = document.getElementById('playBtn');
        const stopBtn = document.getElementById('stopBtn');
        const speedSelect = document.getElementById('speedSelect');
        const statusText = document.getElementById('statusText');
        const voiceSearchBtn = document.getElementById('voiceSearchBtn');

        // Variables de estado
        let currentUtterance = null;
        let currentLessonText = "";
        let currentLessonData = null;
        let recognition = null;

        // Configuración de Groq API (reemplaza con tu API key real)
        const GROQ_API_KEY = "your-groq-api-key-here"; // Reemplazar con tu API key real
        const GROQ_API_URL = "https://api.groq.com/openai/v1/chat/completions";

        // Inicializar reconocimiento de voz si está disponible
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.lang = 'en-US';
            recognition.interimResults = false;

            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                lessonInput.value = transcript;
                loadLesson();
            };

            recognition.onerror = function(event) {
                console.error('Speech recognition error', event.error);
                statusText.textContent = "Error with voice recognition. Please try typing instead.";
            };
        } else {
            voiceSearchBtn.disabled = true;
            voiceSearchBtn.title = "Voice recognition not supported";
        }

        // Función para obtener contenido de la lección desde Groq
        async function getLessonContent(lessonQuery) {
            statusText.innerHTML = "Loading lesson content... <span class='loading'></span>";
            
            try {
                const response = await fetch(GROQ_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${GROQ_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: "llama-3.1-8b-instant", // Puedes cambiar al modelo que prefieras
                        messages: [
                            {
                                role: "system",
                                content: "You are an English teaching assistant. Provide comprehensive, engaging lesson content with unique examples and practice exercises. Structure your response with clear sections for theory and practice. Always generate fresh content, never repeating the same examples."
                            },
                            {
                                role: "user",
                                content: `Create English lesson content for: ${lessonQuery}. Include both theoretical explanations and practical exercises.`
                            }
                        ],
                        temperature: 0.7,
                        max_tokens: 2000
                    })
                });

                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }

                const data = await response.json();
                return data.choices[0].message.content;
            } catch (error) {
                console.error("Error fetching from Groq API:", error);
                // Fallback content if API fails
                return `# ${lessonQuery}\n\n## Theory\nThis lesson covers ${lessonQuery}. Unfortunately, we couldn't connect to the lesson database at this time. Please try again later.\n\n## Practice\nTry to find examples of ${lessonQuery} in English texts around you.`;
            }
        }

        // Función para obtener ejercicios de práctica desde Groq
        async function getPracticeContent(lessonQuery) {
            statusText.innerHTML = "Generating practice exercises... <span class='loading'></span>";
            
            try {
                const response = await fetch(GROQ_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${GROQ_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: "llama-3.1-8b-instant",
                        messages: [
                            {
                                role: "system",
                                content: "You are an English teaching assistant. Create unique, engaging practice exercises that test comprehension of the lesson topic. Include a variety of question types and provide answers."
                            },
                            {
                                role: "user",
                                content: `Create practice exercises for the English lesson: ${lessonQuery}. Include different question types.`
                            }
                        ],
                        temperature: 0.7,
                        max_tokens: 1500
                    })
                });

                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }

                const data = await response.json();
                return data.choices[0].message.content;
            } catch (error) {
                console.error("Error fetching practice from Groq API:", error);
                // Fallback practice content
                return `Practice Exercises for ${lessonQuery}:\n\n1. Create 3 original sentences using what you've learned.\n2. Explain the concept to someone else in your own words.\n3. Find examples of this concept in an English book or website.`;
            }
        }

        // Cargar lección
        async function loadLesson() {
            const input = lessonInput.value.trim();
            
            if (!input) {
                alert("Please enter a lesson number or name");
                return;
            }
            
            // Obtener contenido de la lección desde Groq
            const lessonContentText = await getLessonContent(input);
            
            // Mostrar contenido
            lessonTitle.textContent = input;
            theoryContent.textContent = lessonContentText;
            lessonContent.style.display = 'block';
            
            // Guardar texto para lectura
            currentLessonText = `${input}. ${lessonContentText}`;
            currentLessonData = {
                title: input,
                theory: lessonContentText
            };
            
            // Habilitar controles
            playBtn.disabled = false;
            stopBtn.disabled = false;
            practiceBtn.disabled = false;
            
            // Actualizar estado
            statusText.textContent = "Lesson loaded. Click play to listen";
            
            // Desplazar a la lección
            lessonContent.scrollIntoView({ behavior: 'smooth' });
        }

        // Reproducir audio
        function playAudio() {
            if (!currentLessonText) return;
            
            // Detener audio actual si está reproduciendo
            stopAudio();
            
            // Crear nueva utterance
            currentUtterance = new SpeechSynthesisUtterance(currentLessonText);
            
            // Configurar voz en inglés
            const voices = speechSynthesis.getVoices();
            const englishVoice = voices.find(voice => 
                voice.lang.startsWith('en') && voice.localService === true
            );
            
            if (englishVoice) {
                currentUtterance.voice = englishVoice;
            }
            
            // Configurar velocidad
            currentUtterance.rate = parseFloat(speedSelect.value);
            
            // Eventos
            currentUtterance.onstart = () => {
                statusText.textContent = "Playing...";
                playBtn.disabled = true;
            };
            
            currentUtterance.onend = () => {
                statusText.textContent = "Playback finished";
                playBtn.disabled = false;
                currentUtterance = null;
            };
            
            currentUtterance.onerror = (event) => {
                console.error('Speech synthesis error:', event);
                statusText.textContent = "Error playing audio";
                playBtn.disabled = false;
                currentUtterance = null;
            };
            
            // Reproducir
            speechSynthesis.speak(currentUtterance);
        }

        // Detener audio
        function stopAudio() {
            if (speechSynthesis.speaking) {
                speechSynthesis.cancel();
                statusText.textContent = "Playback stopped";
                playBtn.disabled = false;
            }
        }

        // Cambiar velocidad
        function changeSpeed() {
            if (currentUtterance && speechSynthesis.speaking) {
                currentUtterance.rate = parseFloat(speedSelect.value);
                stopAudio();
                playAudio();
            }
        }

        // Iniciar práctica
        async function startPractice() {
            if (!currentLessonData) return;
            
            // Obtener ejercicios de práctica desde Groq
            const practiceContent = await getPracticeContent(currentLessonData.title);
            
            // Mostrar ejercicios de práctica
            theoryContent.textContent = `${currentLessonData.theory}\n\n--- PRACTICE EXERCISES ---\n\n${practiceContent}`;
            
            // Actualizar texto para lectura
            currentLessonText = `${currentLessonData.title} - Practice Exercises. ${practiceContent}`;
            
            // Actualizar estado
            statusText.textContent = "Practice exercises loaded. Click play to listen";
            
            // Desplazar a la lección
            theoryContent.scrollIntoView({ behavior: 'smooth' });
        }

        // Iniciar búsqueda por voz
        function startVoiceSearch() {
            if (recognition) {
                statusText.textContent = "Listening... Speak now";
                recognition.start();
            }
        }

        // Cargar voces disponibles
        function loadVoices() {
            // En algunos navegadores, las voces no están disponibles inmediatamente
            if (speechSynthesis.getVoices().length > 0) {
                return;
            }
            
            // Esperar a que las voces estén cargadas
            speechSynthesis.onvoiceschanged = () => {
                console.log("Voices loaded:", speechSynthesis.getVoices().length);
            };
        }

        // Event listeners
        searchBtn.addEventListener('click', loadLesson);
        
        lessonInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                loadLesson();
            }
        });
        
        playBtn.addEventListener('click', playAudio);
        stopBtn.addEventListener('click', stopAudio);
        speedSelect.addEventListener('change', changeSpeed);
        practiceBtn.addEventListener('click', startPractice);
        voiceSearchBtn.addEventListener('click', startVoiceSearch);

        // Inicializar
        window.addEventListener('load', () => {
            loadVoices();
            
            // Verificar compatibilidad con speech synthesis
            if (!('speechSynthesis' in window)) {
                statusText.textContent = "Speech synthesis not supported in your browser";
                playBtn.disabled = true;
                stopBtn.disabled = true;
            }
        });
    </script>
</body>
</html>
