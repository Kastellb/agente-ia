<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>St. Mary‚Äôs College</title>
  <style>
    :root{
      --bg:#f5f7fa; --ink:#0f172a; --bot:#0ea5e9; --user:#22c55e; --muted:#64748b;
      --focus:#2563eb; --overlay: rgba(15,23,42,.55);
      --chip:#ffffff; --chip-border:#cbd5e1; --chip-ink:#0f172a;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--ink);
         display:flex;flex-direction:column;min-height:100vh}
    header{background:#0b3b71;color:#fff;padding:12px 16px;display:flex;align-items:center;justify-content:space-between;
           font-weight:700;gap:8px;flex-wrap:wrap}
    .btn{border:0;padding:12px 14px;font-weight:700;cursor:pointer;border-radius:12px;color:#fff;min-height:48px}
    .btn-lessons{background:#7c3aed}
    #chat{flex:1;max-width:900px;width:100%;margin:16px auto;padding:0 12px}
    .bubble{max-width:75%;padding:12px 14px;margin:8px 0;border-radius:14px;line-height:1.45;box-shadow:0 4px 12px rgba(2,8,23,.08)}
    .bot{background:var(--bot);color:#fff;border-bottom-left-radius:4px}
    .user{background:var(--user);color:#fff;margin-left:auto;border-bottom-right-radius:4px}
    .sys{background:#e2e8f0;color:#0f172a;margin:16px auto;border-radius:10px}
    .kbd{font-family:ui-monospace,Menlo,Consolas,monospace;background:#e2e8f0;padding:1px 6px;border-radius:6px}
    .bot .kbd{background:#fff;color:#0f172a}

    #controls{position:sticky;bottom:0;background:#fff;border-top:1px solid #e2e8f0;
      padding:10px clamp(10px,3vw,16px) calc(10px + env(safe-area-inset-bottom)) clamp(10px,3vw,16px);
      display:grid;grid-template-columns:1fr;gap:10px}
    #textInput{width:100%;padding:12px 14px;font-size:16px;border:1px solid #cbd5e1;border-radius:12px;outline:0;min-height:48px}
    #textInput:focus{border-color:var(--focus);box-shadow:0 0 0 3px rgba(37,99,235,.2)}
    .buttons{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    #sendBtn{background:#22c55e} #speakBtn{background:#0ea5e9} #stopBtn{background:#ef4444}
    @media (min-width:720px){#controls{display:flex;align-items:center;gap:10px;padding-bottom:12px}
      #textInput{flex:1}.buttons{display:flex;gap:10px}}

    /* Lessons overlay */
    #lessonsOverlay{position:fixed;inset:0;background:var(--overlay);display:none;align-items:center;justify-content:center;z-index:50}
    #lessonsCard{width:min(820px,94vw);background:#fff;border-radius:16px;padding:16px;box-shadow:0 16px 40px rgba(2,8,23,.35);
      display:flex;flex-direction:column;gap:12px}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .row input{flex:1;min-width:220px;padding:10px 12px;border:1px solid #cbd5e1;border-radius:10px}
    .btn-go{background:#0ea5e9;color:#fff;border:0;padding:10px 12px;border-radius:10px}
    .btn-close{background:#334155;color:#fff;border:0;padding:10px 12px;border-radius:10px}
    .pager{display:flex;gap:8px;flex-wrap:wrap}
    .page-btn{background:#fff;color:#0f172a;border:1px solid #cbd5e1;padding:6px 10px;border-radius:999px;cursor:pointer}
    .page-btn.active{background:#0ea5e9;color:#fff;border-color:#0ea5e9}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(90px,1fr));gap:8px;max-height:340px;overflow:auto;padding:4px}
    .chip{background:var(--chip);border:1px solid var(--chip-border);color:var(--chip-ink);padding:8px 10px;border-radius:999px;
      box-shadow:0 2px 4px rgba(2,8,23,.06);cursor:pointer;font-weight:700;text-align:center}
    .note{font-size:14px;color:#64748b}
  </style>
</head>
<body>
  <header>
    <div>St. Mary‚Äôs College</div>
    <div class="right">
      <button class="btn btn-lessons" id="openLessonsBtn">üìö Lessons</button>
    </div>
  </header>

  <main id="chat"></main>

  <div id="controls">
    <input id="textInput" type="text" placeholder='Type or say your message‚Ä¶ e.g., "Lesson 7"' autocomplete="off"/>
    <div class="buttons">
      <button id="sendBtn"  class="btn">Send</button>
      <button id="speakBtn" class="btn">üé§ Speak</button>
      <button id="stopBtn"  class="btn">‚èπ Stop</button>
    </div>
  </div>

  <!-- Lessons overlay -->
  <div id="lessonsOverlay" role="dialog" aria-modal="true">
    <div id="lessonsCard">
      <h3>Select a lesson</h3>
      <div class="note" id="rangeNote">Loading available range‚Ä¶</div>
      <div class="row">
        <input id="numInput" type="number" min="1" max="270" placeholder="Go to lesson # (e.g., 12)"/>
        <input id="wordsInput" type="text" placeholder="Or type in words (e.g., twenty three)"/>
        <button class="btn-go" id="goBtn">Go</button>
        <button class="btn-close" id="closeLessonsBtn">Close</button>
      </div>
      <div class="pager" id="pager"></div>
      <div class="grid"  id="grid"></div>
      <div class="note">Tip: you can also type <span class="kbd">Lesson 12</span> in the chat.</div>
    </div>
  </div>

<script>
/* =============== Basic UI helpers =============== */
const chat = document.getElementById("chat");
function addMessage(html, role="bot"){ const el=document.createElement("div"); el.className=`bubble ${role}`; el.innerHTML=html; chat.appendChild(el); chat.scrollTop=chat.scrollHeight; }
function addSystem(text){ const el=document.createElement("div"); el.className="bubble sys"; el.textContent=text; chat.appendChild(el); chat.scrollTop=chat.scrollHeight; }

/* =============== English-only guard (blocks Spanish content) =============== */
const SPANISH_RE = /[√°√©√≠√≥√∫√±√º¬ø¬°]|(?:\b(?:el|la|los|las|de|del|al|y|o|pero|porque|con|sin|para|por|un|una|unos|unas|es|est√°|hola|gracias|buenos|buenas|tardes|noches|por favor|c√≥mo|qu√©|d√≥nde|cu√°ndo|lecci√≥n|leccion)\b)/i;
const SP_STOP = new Set(["de","la","que","el","en","y","a","los","del","se","las","por","un","para","con","no","una","su","al","lo","como","m√°s","o","pero","sus","le","ya","este","s√≠","porque","esta","entre","cuando","muy","sin","sobre","tambi√©n","me","hasta"]);
function looksSpanish(text){
  const s=(text||"").toLowerCase();
  if(SPANISH_RE.test(s)) return true;
  const tokens=s.replace(/[^a-z\s]/g," ").split(/\s+/).filter(Boolean);
  if(!tokens.length) return false;
  let hits=0; for(const t of tokens){ if(SP_STOP.has(t)) hits++; }
  return hits/tokens.length>0.25;
}

/* =============== Speech (clean, English only) =============== */
function sanitizeForSpeech(t){
  t=String(t||""); t=t.replace(/<[^>]*>/g," "); t=t.replace(/\bhttps?:\/\/\S+/gi," ");
  try{ t=t.replace(/\p{Extended_Pictographic}/gu,""); }catch{ t=t.replace(/[\u{1F300}-\u{1FAFF}\u{2600}-\u{27BF}]/gu,""); }
  t=t.replace(/&[a-z]+;/gi," ").replace(/\s{2,}/g," ").trim();
  return t;
}
function speakSafe(text){
  try{
    const msg=sanitizeForSpeech(text);
    if(!msg || looksSpanish(msg)) return; // never speak Spanish
    speechSynthesis.cancel();
    const u=new SpeechSynthesisUtterance(msg);
    u.lang="en-US";
    speechSynthesis.speak(u);
  }catch{}
}
function stopAll(){ try{ if(recognition) recognition.stop(); speechSynthesis.cancel(); }catch{} }

/* =============== Parse "Lesson N" (digits or English words) =============== */
function wordsToNumberEN(phrase){
  const ones={zero:0,one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9};
  const teens={ten:10,eleven:11,twelve:12,thirteen:13,fourteen:14,fifteen:15,sixteen:16,seventeen:17,eighteen:18,nineteen:19};
  const tens={twenty:20,thirty:30,forty:40,fifty:50,sixty:60,seventy:70,eighty:80,ninety:90};
  let s=(phrase||"").toLowerCase().replace(/-/g,' ').replace(/[^a-z\s]/g,' ').replace(/\s+/g,' ').trim();
  if(ones[s]!=null) return ones[s]; if(teens[s]!=null) return teens[s]; if(tens[s]!=null) return tens[s];
  const tokens=s.split(' '); let total=0,current=0;
  for(const w of tokens){
    if(ones[w]!=null){ current+=ones[w]; continue; }
    if(teens[w]!=null){ current+=teens[w]; continue; }
    if(tens[w]!=null){ current+=tens[w]; continue; }
    if(w==="hundred"){ if(current===0) current=1; current*=100; total+=current; current=0; continue; }
    if(w==="and"){ continue; }
    return null;
  }
  total+=current; return total||null;
}
function parseLessonNumberFromText(text){
  const s=(text||"").toLowerCase();
  let m=s.match(/\blesson\s+(\d{1,3})\b/); if(m){ const n=parseInt(m[1],10); if(n>=1&&n<=270) return n; }
  m=s.match(/\blesson\s+([a-z\s-]{1,60})$/i) || s.match(/\blesson\s+([a-z\s-]{1,60})\b/i);
  if(m){ const n=wordsToNumberEN(m[1]); if(n&&n>=1&&n<=270) return n; }
  return null;
}

/* =============== Global state =============== */
let availableLessons=[];
const PAGE_SIZE=30; let pages=[], currentPage=0;

let currentLesson=null, lessonData=null;
const QUIZ_MIN=5, QUIZ_PASS=0.90;
let quizActive=false, quizIndex=0, quizCorrect=0, quizQuestions=[];
let pendingLesson=null, pendingData=null;
let sessionLocked=false;

/* =============== Lessons overlay =============== */
const lessonsOverlay = document.getElementById("lessonsOverlay");
const openLessonsBtn = document.getElementById("openLessonsBtn");
const closeLessonsBtn = document.getElementById("closeLessonsBtn");
const rangeNote = document.getElementById("rangeNote");
const pager = document.getElementById("pager");
const grid = document.getElementById("grid");
const numInput = document.getElementById("numInput");
const wordsInput = document.getElementById("wordsInput");
const goBtn = document.getElementById("goBtn");

async function fetchAvailableLessons(){
  try{
    const r=await fetch("https://www.leccion.datafast.pw/lessons/index.json",{cache:"no-store"});
    if(!r.ok) throw 0;
    const idx=await r.json();
    const arr=Array.isArray(idx.available)?idx.available:[];
    availableLessons=arr.map(n=>parseInt(n,10)).filter(n=>!isNaN(n)).sort((a,b)=>a-b);
  }catch{ availableLessons=[]; }
}
function makePages(list){ const out=[]; for(let i=0;i<list.length;i+=PAGE_SIZE) out.push(list.slice(i,i+PAGE_SIZE)); return out; }
function renderPager(){ pager.innerHTML=""; if(pages.length<=1) return;
  pages.forEach((_,i)=>{ const s=pages[i][0], e=pages[i][pages[i].length-1];
    const b=document.createElement("button"); b.className="page-btn"+(i===currentPage?" active":""); b.textContent=`${s}‚Äì${e}`;
    b.onclick=()=>{ currentPage=i; renderGrid(); renderPager(); }; pager.appendChild(b);
  });
}
function renderGrid(){ grid.innerHTML=""; if(!pages.length){ grid.innerHTML="<div class='note'>No lessons found.</div>"; return; }
  pages[currentPage].forEach(n=>{ const c=document.createElement("div"); c.className="chip"; c.textContent=`Lesson ${n}`; c.onclick=()=> beginLessonSelection(n); grid.appendChild(c); });
}
async function prepareLessonsOverlay(){
  await fetchAvailableLessons();
  const list=availableLessons.length?availableLessons:Array.from({length:270},(_,i)=>i+1);
  pages=makePages(list); currentPage=0; renderPager(); renderGrid();
  if(availableLessons.length){ rangeNote.textContent=`Available range: Lesson ${availableLessons[0]} to Lesson ${availableLessons[availableLessons.length-1]}.`; }
  else{ rangeNote.textContent=`No index found; showing full range 1‚Äì270.`; }
}
function openLessons(){ lessonsOverlay.style.display="flex"; numInput.focus(); }
function closeLessons(){ lessonsOverlay.style.display="none"; numInput.value=""; wordsInput.value=""; }
openLessonsBtn.onclick=()=>{ prepareLessonsOverlay().then(openLessons); };
closeLessonsBtn.onclick=closeLessons;
lessonsOverlay.addEventListener("click", e=>{ if(e.target===lessonsOverlay) closeLessons(); });
function goFromOverlay(){
  let n=parseInt(numInput.value,10);
  if(!n && wordsInput.value.trim()){ const w=wordsToNumberEN(wordsInput.value.trim()); if(w) n=w; }
  if(!n || n<1 || n>270){ addSystem("Please type a valid lesson number (1‚Äì270)."); return; }
  beginLessonSelection(n);
}
goBtn.onclick=goFromOverlay;
numInput.addEventListener("keydown", e=>{ if(e.key==="Enter") goFromOverlay(); });
wordsInput.addEventListener("keydown", e=>{ if(e.key==="Enter") goFromOverlay(); });

/* =============== Lesson loading & Quiz gate =============== */
async function fetchLessonJSON(num){
  try{
    const res=await fetch(`https://www.leccion.datafast.pw/lessons/lesson${num}.json`,{cache:"no-store"});
    if(!res.ok) return {ok:false, error:"not-found"};
    const data=await res.json();

    // Block if the lesson appears to contain Spanish (absolutely no Spanish allowed)
    const buf=[];
    if(data.title) buf.push(data.title);
    if(data.theory) buf.push(data.theory);
    (data.objectives||[]).forEach(x=>buf.push(x));
    (data.topics||[]).forEach(x=>buf.push(x));
    (data.content||[]).forEach(c=>{ if(c.question) buf.push(c.question); if(c.answer) buf.push(c.answer); });
    if(looksSpanish(buf.join(" "))) return {ok:false, error:"spanish"};

    return {ok:true, data};
  }catch{ return {ok:false, error:"fetch-failed"}; }
}
function normalize(s){ return (s||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s]/g," ").replace(/\s+/g," ").trim(); }
function isAnswerCorrect(user, expected){
  const U=normalize(user), E=normalize(expected);
  if(!E) return false;
  if(U.includes(E)) return true;
  const et=E.split(" "), ut=new Set(U.split(" ")); const hits=et.filter(w=>ut.has(w)).length;
  if(et.length>=3 && hits/et.length>=0.8) return true;
  if(et.length<=2 && hits===et.length) return true;
  return false;
}
function askNextQuiz(){
  if(quizIndex>=quizQuestions.length){
    const total=quizQuestions.length, score=Math.round((quizCorrect/total)*100);
    const pass=score>=Math.ceil(QUIZ_PASS*100);
    addMessage(`Quiz finished. Score: <b>${quizCorrect}/${total}</b> = <b>${score}%</b>.`,"bot");
    if(pass){
      addMessage("‚úÖ Passed. Access granted to the selected lesson. Opening now‚Ä¶","bot");
      lessonData=pendingData; currentLesson=pendingLesson;
      const intro=`
        <b>Welcome to Lesson ${currentLesson}: ${lessonData.title||""}</b><br><br>
        <b>Theory:</b> ${lessonData.theory||"This lesson will guide you through the basics."}<br><br>
        <b>Objectives:</b><br>- ${(lessonData.objectives||[]).join("<br>- ")}<br><br>
        <b>Topics:</b><br>- ${(lessonData.topics||[]).join("<br>- ")}<br><br>
        Ask me anything about this lesson and I will explain, correct, and reinforce.
      `;
      addMessage(intro,"bot"); speakSafe("Lesson opened.");
      quizActive=false; quizQuestions=[]; quizIndex=0; quizCorrect=0;
      sessionLocked=false; input.disabled=false; sendBtn.disabled=false; speakBtn.disabled=false;
    }else{
      addMessage("‚ùå You did not reach 90%. Please review the previous lesson carefully before advancing. Your session has ended. Thank you.","bot");
      speakSafe("You did not reach ninety percent. Please review the previous lesson. This session has ended.");
      quizActive=false; sessionLocked=true; input.disabled=true; sendBtn.disabled=true; speakBtn.disabled=true;
    }
    return;
  }
  const q=quizQuestions[quizIndex].q;
  addMessage(`(${quizIndex+1}/${quizQuestions.length}) <b>${q}</b>`,"bot");
  speakSafe(q);
}
async function startQuizGate(targetNum, targetData){
  if(targetNum===1){
    sessionLocked=false; input.disabled=false; sendBtn.disabled=false; speakBtn.disabled=false;
    lessonData=targetData; currentLesson=1;
    const intro=`
      <b>Welcome to Lesson 1: ${lessonData.title||""}</b><br><br>
      <b>Theory:</b> ${lessonData.theory||"This lesson will guide you through the basics."}<br><br>
      <b>Objectives:</b><br>- ${(lessonData.objectives||[]).join("<br>- ")}<br><br>
      <b>Topics:</b><br>- ${(lessonData.topics||[]).join("<br>- ")}<br><br>
      Ask me anything about this lesson and I will explain, correct, and reinforce.
    `;
    addMessage(intro,"bot"); speakSafe("Lesson one is open."); return;
  }
  const prev=await fetchLessonJSON(targetNum-1);
  if(!prev.ok){
    const msg = prev.error==="spanish"
      ? `Cannot start the quiz because Lesson ${targetNum-1} appears to contain Spanish. Please upload the English-only version.`
      : `Cannot start the quiz because Lesson ${targetNum-1} is unavailable.`;
    addMessage(msg,"bot"); return;
  }
  const items=(prev.data.content||[]).filter(c=>c && c.question && c.answer);
  if(items.length<QUIZ_MIN){ addMessage(`The previous lesson (${targetNum-1}) does not have enough questions to build a quiz (found ${items.length}).`, "bot"); return; }
  const shuffled=[...items].sort(()=>Math.random()-0.5);
  const count=Math.min(10, Math.max(QUIZ_MIN, shuffled.length));
  quizQuestions=shuffled.slice(0,count).map(c=>({q:c.question,a:c.answer}));
  quizActive=true; quizIndex=0; quizCorrect=0; pendingLesson=targetNum; pendingData=targetData;
  addMessage(`To access <b>Lesson ${targetNum}: ${targetData.title||""}</b>, please answer these questions from <b>Lesson ${targetNum-1}</b>. You must score <b>‚â• 90%</b>.`,"bot");
  speakSafe(`Starting the quiz for lesson ${targetNum-1}.`);
  askNextQuiz();
}
async function beginLessonSelection(n){
  const r=await fetchLessonJSON(n);
  if(!r.ok){
    const msg = r.error==="spanish"
      ? `Lesson ${n} appears to contain Spanish. Please upload the English-only version.`
      : `Could not load Lesson ${n}.`;
    addMessage(msg,"bot"); return;
  }
  addMessage(`Lesson ${n} selected: <b>${r.data.title||""}</b>.`, "bot");
  if(n>1){ addMessage(`Before we begin, I will ask you some questions from <b>Lesson ${n-1}</b> to verify mastery.`, "bot"); }
  await startQuizGate(n, r.data);
}

/* =============== Teacher (strict English-only; JSON-first, Groq fallback) =============== */
async function teacherResponse(userText){
  if(looksSpanish(userText)){
    const msg="Please write in English. English-only mode is active.";
    addMessage(msg,"bot"); speakSafe(msg); return;
  }
  // Quick local answers from JSON
  const q=userText.toLowerCase(); let local="";
  if(lessonData){
    if(/objective|goal/.test(q)){ local="Objectives:\n- "+(lessonData.objectives||[]).join("\n- "); }
    else if(/topic|point|content list/.test(q)){ local="Topics:\n- "+(lessonData.topics||[]).join("\n- "); }
    else if(/example|exercise|question/.test(q) && Array.isArray(lessonData.content) && lessonData.content.length){
      const qs=lessonData.content.map(c=>"‚Ä¢ "+c.question).join("\n"); local="Sample questions:\n"+qs;
    }
  }
  if(local){ addMessage(local.replace(/\n/g,"<br>"),"bot"); speakSafe("Here you are."); return; }

  // Groq teacher (proxy)
  let answer="";
  try{
    const response=await fetch("https://bot-maestro-proxy.kast-mercadeo.workers.dev/",{
      method:"POST", headers:{"Content-Type":"application/json"},
      body:JSON.stringify({ text:`ROLE: You are an English teacher at St. Mary's College.
HARD RULES: Respond STRICTLY in English. Never use Spanish. If the student writes in Spanish, reply in English and ask them to switch to English.
CONTEXT: Current lesson = ${lessonData ? lessonData.title : "current lesson (JSON)"}.
TASKS:
1) If the student's sentence has grammar or pronunciation issues, first show a corrected version.
2) Then explain briefly (1‚Äì2 lines) and give 2‚Äì3 short examples.
3) Stay strictly on the current lesson theme.
4) Encourage politely and, if relevant, suggest one short practice line to repeat.

Student says: "${userText}"`})
    });
    const data=await response.json(); answer=data.reply||"(no reply)";
  }catch{
    const alternatives=[
      "We say 'Good morning' until noon. 'Good night' is a farewell, not a greeting.",
      "Formal greetings show respect, like 'Good morning'. Informal ones include 'Hi' or 'Hey'.",
      "Use 'There is' for singular and 'There are' for plural; questions: 'Is there‚Ä¶?' / 'Are there‚Ä¶?'."
    ];
    answer=alternatives[Math.floor(Math.random()*alternatives.length)];
  }
  if(looksSpanish(answer)){ answer="(Blocked non-English output). Please keep the conversation in English."; }
  addMessage(answer.replace(/\n/g,"<br>"),"bot"); speakSafe(answer);
}

/* =============== Input & speech =============== */
const input = document.getElementById("textInput");
const sendBtn = document.getElementById("sendBtn");
const speakBtn = document.getElementById("speakBtn");
const stopBtn = document.getElementById("stopBtn");

async function handleUserMessage(text){
  if(!text) return;
  addMessage(text,"user");
  if(sessionLocked){ addMessage("This session has ended. Please review the previous lesson and start again.", "bot"); return; }

  if(quizActive){
    const expected=quizQuestions[quizIndex].a;
    if(isAnswerCorrect(text, expected)){ quizCorrect++; addMessage("‚úÖ Correct.","bot"); }
    else{ addMessage(`‚ùå Incorrect. Expected: <b>${expected}</b>`, "bot"); }
    quizIndex++; askNextQuiz(); return;
  }

  const n=parseLessonNumberFromText(text);
  if(n){ await beginLessonSelection(n); return; }

  if(lessonData){ await teacherResponse(text); }
  else{ addMessage(`Welcome! Tell me which lesson you want to review (e.g., <span class="kbd">Lesson 1</span>).`, "bot"); }
}
function sendMessage(){ const t=input.value.trim(); input.value=""; handleUserMessage(t); }
sendBtn.onclick=sendMessage;
input.addEventListener("keydown", e=>{ if(e.key==="Enter") sendMessage(); });

let recognition=null;
if("webkitSpeechRecognition" in window){
  recognition=new webkitSpeechRecognition();
  recognition.lang="en-US"; recognition.interimResults=false; recognition.maxAlternatives=1;
  recognition.onresult=e=>{ const t=e.results[0][0].transcript; handleUserMessage(t); };
}
speakBtn.onclick=()=>{ if(recognition) recognition.start(); };
stopBtn.onclick =()=>{ stopAll(); };

/* =============== Boot (always greets) =============== */
(async function init(){
  sessionLocked=false; input.disabled=false; sendBtn.disabled=false; speakBtn.disabled=false;
  addMessage(`Welcome! Tell me which lesson you want to review (e.g., <span class="kbd">Lesson 1</span>).`, "bot");
  try{
    await fetchAvailableLessons();
    if(availableLessons.length){
      addSystem(`Available range: Lesson ${availableLessons[0]} to Lesson ${availableLessons[availableLessons.length-1]}. Tap ‚Äúüìö Lessons‚Äù.`);
    }else{
      addSystem(`Tip: create <index.json> to control availability. Showing full range 1‚Äì270.`);
    }
  }catch{}
})();
</script>
</body>
</html>
